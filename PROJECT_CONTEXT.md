# Valaxy Blog - é¡¹ç›®ä¸Šä¸‹æ–‡ Prompt

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Valaxy (v0.26.3)** æ„å»ºçš„ä¸ªäººåšå®¢é¡¹ç›®ï¼Œä½¿ç”¨ `valaxy-theme-yun` ä¸»é¢˜ï¼Œéƒ¨ç½²åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šã€‚é¡¹ç›®åŒ…å«è‡ªå®šä¹‰çš„ç›¸å†Œç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒç…§ç‰‡ä¸Šä¼ å’Œè‡ªåŠ¨æ„å»ºéƒ¨ç½²ã€‚

### å…³é”®ä¿¡æ¯

- **æ¡†æ¶**: Valaxy + Vue 3 + Vite
- **ä¸»é¢˜**: valaxy-theme-yun
- **åŒ…ç®¡ç†å™¨**: pnpm
- **éƒ¨ç½²æ–¹å¼**: é˜¿é‡Œäº‘äº‘æ•ˆ Flow è‡ªåŠ¨åŒ–éƒ¨ç½²
- **æœåŠ¡å™¨**: é˜¿é‡Œäº‘è½»é‡æœåŠ¡å™¨ 47.104.216.235
- **åŸŸå**: https://kylaan.top
- **Node.js**: v20+ (æœ¬åœ°) / v25.1.0 (æœåŠ¡å™¨)

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç›®å½•ç»“æ„

```
blog_valaxy/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ copilot-instructions.md    # AI Agent æŒ‡ä»¤æ–‡æ¡£
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml              # GitHub Actions (å¤‡ç”¨)
â”‚
â”œâ”€â”€ album-admin/                    # ğŸ“¸ ç›¸å†Œç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html             # ä¸Šä¼ ç•Œé¢
â”‚   â”œâ”€â”€ server.js                  # Express åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ components/                     # è‡ªå®šä¹‰ Vue ç»„ä»¶
â”‚   â”œâ”€â”€ YunFooter.vue              # è‡ªå®šä¹‰é¡µè„š
â”‚   â””â”€â”€ YunSponsor.vue             # èµåŠ©ç»„ä»¶
â”‚
â”œâ”€â”€ layouts/                        # è‡ªå®šä¹‰é¡µé¢å¸ƒå±€
â”‚   â””â”€â”€ albums.vue                 # ğŸ“… ç›¸å†Œæ—¥å†å¸ƒå±€ï¼ˆé‡è¦ï¼ï¼‰
â”‚
â”œâ”€â”€ pages/                          # ğŸ“ å†…å®¹é¡µé¢
â”‚   â”œâ”€â”€ albums/                    # ç›¸å†Œ Markdown æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.md
â”‚   â”‚   â”œâ”€â”€ 2025-10-29.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ posts/                     # åšå®¢æ–‡ç« 
â”‚   â””â”€â”€ about/                     # å…³äºé¡µé¢
â”‚
â”œâ”€â”€ public/                         # é™æ€èµ„æº
â”‚   â”œâ”€â”€ albums/                    # ğŸ“· ç›¸å†Œå›¾ç‰‡ç›®å½•
â”‚   â”‚   â”œâ”€â”€ 2025-10-29/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ img/
â”‚
â”œâ”€â”€ styles/                         # è‡ªå®šä¹‰æ ·å¼
â”‚   â”œâ”€â”€ vars.scss                  # ä¸»é¢˜å˜é‡è¦†ç›–
â”‚   â””â”€â”€ index.scss                 # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ docs/                           # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ALIYUN_FLOW_GUIDE.md       # é˜¿é‡Œäº‘äº‘æ•ˆéƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ DEPLOYMENT_SUMMARY.md       # éƒ¨ç½²æ€»ç»“
â”‚   â””â”€â”€ QUICK_START.md             # å¿«é€Ÿå¼€å§‹
â”‚
â”œâ”€â”€ scripts/                        # è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ auto-commit.bat            # Windows è‡ªåŠ¨æäº¤
â”‚   â””â”€â”€ auto-commit.sh             # Linux è‡ªåŠ¨æäº¤
â”‚
â”œâ”€â”€ .flow.yml                       # âš™ï¸ é˜¿é‡Œäº‘äº‘æ•ˆé…ç½®ï¼ˆå…³é”®ï¼‰
â”œâ”€â”€ valaxy.config.ts               # Valaxy ä¸»é…ç½®
â”œâ”€â”€ site.config.ts                 # ç½‘ç«™å…ƒæ•°æ®é…ç½®
â”œâ”€â”€ locales/                        # å›½é™…åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ zh-CN.yml
â”‚   â””â”€â”€ en.yml
â””â”€â”€ package.json                    # é¡¹ç›®ä¾èµ–
```

---

## ğŸ”‘ å…³é”®åŠŸèƒ½æ¨¡å—

### 1. ç›¸å†Œç®¡ç†ç³»ç»Ÿ (`album-admin/`)

**ç›®çš„**: æä¾› Web ç•Œé¢ä¸Šä¼ ç…§ç‰‡ï¼Œè‡ªåŠ¨ç”Ÿæˆ Markdown å¹¶è§¦å‘ç½‘ç«™æ„å»ºã€‚

**æ ¸å¿ƒæ–‡ä»¶**: `album-admin/server.js`

**åŠŸèƒ½**:
- âœ… ç…§ç‰‡ä¸Šä¼ ï¼ˆæ”¯æŒå¤šå¼ ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆç›¸å†Œ Markdown æ–‡ä»¶
- âœ… è§¦å‘å…¨é‡æ„å»º `pnpm build:ssg`
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindows æœ¬åœ° / Linux æœåŠ¡å™¨ï¼‰
- âœ… å¯†ç ä¿æŠ¤ï¼ˆç¯å¢ƒå˜é‡ `ADMIN_PASSWORD`ï¼‰

**API ç«¯ç‚¹**:
- `POST /api/auth` - éªŒè¯å¯†ç 
- `GET /api/albums` - è·å–ç›¸å†Œåˆ—è¡¨
- `POST /api/albums` - ä¸Šä¼ ç›¸å†Œ
- `DELETE /api/albums/:filename` - åˆ é™¤ç›¸å†Œ
- `POST /api/build` - æ‰‹åŠ¨è§¦å‘æ„å»º
- `GET /api/build-status` - æŸ¥çœ‹æ„å»ºçŠ¶æ€

**ç¯å¢ƒå˜é‡** (`.env`):
```env
PORT=3000
HOST=0.0.0.0              # æœåŠ¡å™¨ï¼š0.0.0.0ï¼Œæœ¬åœ°ï¼š127.0.0.1
ADMIN_PASSWORD=yourpass
```

**æ„å»ºé€»è¾‘**:
```javascript
// è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿ
const isWindows = process.platform === 'win32';
const buildCommand = isWindows
  ? `cd "${BLOG_ROOT}" && pnpm build:ssg`  // Windows
  : `cd ${BLOG_ROOT} && NODE_OPTIONS="--max-old-space-size=2048" pnpm build:ssg`;  // Linux
```

---

### 2. ç›¸å†Œæ—¥å†å¸ƒå±€ (`layouts/albums.vue`)

**ç›®çš„**: æ˜¾ç¤ºäº¤äº’å¼æ—¥å†ï¼Œé«˜äº®æœ‰ç›¸å†Œçš„æ—¥æœŸã€‚

**å…³é”®ç‰¹æ€§**:
- âœ… Vue 3 ç»„åˆå¼ API
- âœ… å¯†ç ä¿æŠ¤åŠŸèƒ½
- âœ… å“åº”å¼æ—¥å†ç½‘æ ¼
- âœ… **æ—¥æœŸåŒ¹é…ä¿®å¤**ï¼šä½¿ç”¨æœ¬åœ°æ—¥æœŸæ ¼å¼é¿å…æ—¶åŒºé—®é¢˜

**æ—¥æœŸåŒ¹é…é€»è¾‘**ï¼ˆé‡è¦ï¼ï¼‰:
```javascript
// âŒ é”™è¯¯ï¼šä½¿ç”¨ UTC å¯¼è‡´æ—¶åŒºåç§»
const key = d.toISOString().slice(0, 10);

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æœ¬åœ°æ—¥æœŸæ ¼å¼
const key = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
```

---

### 3. éƒ¨ç½²ç³»ç»Ÿ

#### æ–¹å¼ 1: é˜¿é‡Œäº‘äº‘æ•ˆ Flowï¼ˆä¸»è¦ï¼‰

**é…ç½®æ–‡ä»¶**: `.flow.yml`

**æµç¨‹**:
1. ç›‘å¬ `main` åˆ†æ”¯ push äº‹ä»¶
2. åœ¨äº‘æ•ˆæœåŠ¡å™¨ä¸Šæ„å»ºï¼ˆ`pnpm install` + `pnpm build:ssg`ï¼‰
3. é€šè¿‡ SSH ä¸Šä¼  `dist.tar.gz` åˆ°æœåŠ¡å™¨
4. è‡ªåŠ¨è§£å‹å¹¶é‡æ–°åŠ è½½ Nginx

**å…³é”®é…ç½®**:
```yaml
deploy:
  image: registry.cn-beijing.aliyuncs.com/aliyun-fc/runtime-nodejs20:build-2.0.4
  steps:
    - run: pnpm install
    - run: pnpm build:ssg
    - run: tar -czf dist.tar.gz dist
    - run: scp dist.tar.gz root@47.104.216.235:/tmp/
    - run: ssh root@47.104.216.235 "cd /www/wwwroot/blog_valaxy && ..."
```

#### æ–¹å¼ 2: GitHub Actionsï¼ˆå¤‡ç”¨ï¼‰

**é…ç½®æ–‡ä»¶**: `.github/workflows/deploy.yml`

---

## ğŸ¨ ä¸»é¢˜å®šåˆ¶

### é…ç½®æ–‡ä»¶

**`valaxy.config.ts`**:
- Valaxy ä¸»é…ç½®
- æ’ä»¶é…ç½®ï¼ˆWaline è¯„è®ºã€LightGalleryï¼‰
- ä¸»é¢˜é…ç½®

**`site.config.ts`**:
- ç½‘ç«™å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æè¿°ã€ä½œè€…ï¼‰
- å¯¼èˆªé“¾æ¥
- ç¤¾äº¤åª’ä½“é“¾æ¥

### æ ·å¼è¦†ç›–

**`styles/vars.scss`**:
```scss
:root {
  --va-c-primary: #0078e7;
}
```

---

## ğŸš€ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
# è®¿é—® http://localhost:4859

# å¯åŠ¨ç›¸å†Œç®¡ç†ç³»ç»Ÿ
cd album-admin
node server.js
# è®¿é—® http://127.0.0.1:3000
```

### å†…å®¹åˆ›å»º

**åšå®¢æ–‡ç« **:
```bash
# åœ¨ pages/posts/ åˆ›å»º .md æ–‡ä»¶
---
title: æˆ‘çš„æ–‡ç« 
date: 2025-10-30
categories: [æŠ€æœ¯]
tags: [Vue, Valaxy]
---

æ–‡ç« å†…å®¹...
```

**ç›¸å†Œ**:
1. è®¿é—® `http://127.0.0.1:3000`ï¼ˆæœ¬åœ°ï¼‰æˆ– `http://47.104.216.235:3000`ï¼ˆæœåŠ¡å™¨ï¼‰
2. è¾“å…¥å¯†ç ï¼š`yourpass`
3. ä¸Šä¼ ç…§ç‰‡å¹¶å¡«å†™ä¿¡æ¯
4. è‡ªåŠ¨ç”Ÿæˆ Markdown å¹¶è§¦å‘æ„å»º

### éƒ¨ç½²æµç¨‹

```bash
# æœ¬åœ°æ„å»ºï¼ˆç”¨äºæµ‹è¯•ï¼‰
pnpm build:ssg

# æ¨é€åˆ° GitHub è§¦å‘è‡ªåŠ¨éƒ¨ç½²
git add .
git commit -m "feat: æ·»åŠ æ–°å†…å®¹"
git push origin main

# é˜¿é‡Œäº‘äº‘æ•ˆè‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²
```

---

## âš™ï¸ æœåŠ¡å™¨é…ç½®

### æœåŠ¡å™¨ä¿¡æ¯

- **IP**: 47.104.216.235
- **è·¯å¾„**: `/www/wwwroot/blog_valaxy/`
- **Nginx**: é…ç½®åœ¨å®å¡”é¢æ¿
- **PM2**: ç®¡ç† album-admin æœåŠ¡

### æœåŠ¡ç®¡ç†

```bash
# SSH è¿æ¥
ssh root@47.104.216.235

# PM2 ç®¡ç†
pm2 list
pm2 restart album-admin
pm2 logs album-admin

# Nginx é‡è½½
nginx -s reload

# æ„å»ºç½‘ç«™ï¼ˆå¦‚æœéœ€è¦æ‰‹åŠ¨ï¼‰
cd /www/wwwroot/blog_valaxy
pnpm build:ssg
```

### ç›®å½•æƒé™

```bash
# dist ç›®å½•éœ€è¦ www:www æƒé™ï¼ˆNginx ç”¨æˆ·ï¼‰
chown -R www:www /www/wwwroot/blog_valaxy/dist
chmod -R 755 /www/wwwroot/blog_valaxy/dist
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ—¥å†æ—¥æœŸæ˜¾ç¤ºé”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰

**é—®é¢˜**: æ—¥å†é«˜äº®çš„æ—¥æœŸæ¯”å®é™…æ—¥æœŸå°‘ä¸€å¤©ã€‚

**åŸå› **: ä½¿ç”¨ `toISOString()` å¯¼è‡´ UTC æ—¶åŒºè½¬æ¢ã€‚

**è§£å†³**: ä½¿ç”¨æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè§ `layouts/albums.vue` ç¬¬ 176-180 è¡Œï¼‰ã€‚

### 2. æœåŠ¡å™¨æ„å»ºå†…å­˜ä¸è¶³

**é—®é¢˜**: `pnpm build:ssg` å¤±è´¥ï¼Œæç¤º "JavaScript heap out of memory"ã€‚

**è§£å†³**: 
- åœ¨æ„å»ºå‘½ä»¤ä¸­å¢åŠ å†…å­˜é™åˆ¶ï¼š`NODE_OPTIONS="--max-old-space-size=2048"`
- æˆ–ä½¿ç”¨äº‘æ•ˆ Flow åœ¨äº‘ç«¯æ„å»ºï¼ˆæ¨èï¼‰

### 3. ç…§ç‰‡ä¸Šä¼ åç½‘ç«™ä¸æ›´æ–°

**é—®é¢˜**: ä¸Šä¼ ç…§ç‰‡åï¼Œç½‘ç«™æ²¡æœ‰æ˜¾ç¤ºæ–°ç›¸å†Œã€‚

**åŸå› **: 
- Valaxy æ˜¯ Vue SSR åº”ç”¨ï¼Œå¿…é¡»å®Œæ•´æ„å»º
- å¢é‡æ„å»ºç”Ÿæˆçš„ç®€å• HTML æ— æ³•è¢« Vue Router è¯†åˆ«

**è§£å†³**: ä½¿ç”¨å…¨é‡æ„å»º `pnpm build:ssg`ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

### 4. album-admin æ— æ³•ä»å¤–ç½‘è®¿é—®

**é—®é¢˜**: `http://47.104.216.235:3000` è®¿é—®è¶…æ—¶ã€‚

**åŸå› **: `.env` ä¸­ `HOST=127.0.0.1` åªç›‘å¬æœ¬åœ°å›ç¯ã€‚

**è§£å†³**: æ”¹ä¸º `HOST=0.0.0.0`

---

## ğŸ“¦ ä¾èµ–ç®¡ç†

### ä¸»é¡¹ç›®ä¾èµ–

```json
{
  "valaxy": "0.26.3",
  "valaxy-theme-yun": "0.26.3",
  "valaxy-addon-waline": "^0.2.1",
  "valaxy-addon-lightgallery": "^0.0.4"
}
```

### album-admin ä¾èµ–

```json
{
  "express": "^4.18.2",
  "multer": "^1.4.5-lts.1",
  "cors": "^2.8.5",
  "dotenv": "^16.0.3"
}
```

---

## ğŸ“ é‡è¦æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ä½œç”¨ | ä¿®æ”¹é¢‘ç‡ |
|------|------|---------|
| `valaxy.config.ts` | Valaxy æ ¸å¿ƒé…ç½® | å¶å°” |
| `site.config.ts` | ç½‘ç«™å…ƒæ•°æ® | å¶å°” |
| `layouts/albums.vue` | ç›¸å†Œæ—¥å†ç»„ä»¶ | å¾ˆå°‘ |
| `album-admin/server.js` | ç›¸å†Œä¸Šä¼ åç«¯ | å¾ˆå°‘ |
| `.flow.yml` | äº‘æ•ˆéƒ¨ç½²é…ç½® | å¾ˆå°‘ |
| `pages/posts/*.md` | åšå®¢æ–‡ç«  | é¢‘ç¹ |
| `pages/albums/*.md` | ç›¸å†Œå†…å®¹ | é¢‘ç¹ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**:
   - å›¾ç‰‡å‹ç¼©å’Œ WebP è½¬æ¢
   - CDN åŠ é€Ÿé™æ€èµ„æº

2. **åŠŸèƒ½å¢å¼º**:
   - ç›¸å†Œæ‰¹é‡ç®¡ç†ç•Œé¢
   - æ”¯æŒè§†é¢‘ä¸Šä¼ 
   - ç›¸å†Œåˆ†ç±»å’Œæ ‡ç­¾

3. **å¼€å‘ä½“éªŒ**:
   - æ·»åŠ  Prettier æ ¼å¼åŒ–
   - é…ç½® ESLint
   - å•å…ƒæµ‹è¯•

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **Valaxy æ–‡æ¡£**: https://valaxy.site/
- **ä¸»é¢˜æ–‡æ¡£**: https://yun.valaxy.site/
- **æœåŠ¡å™¨**: https://kylaan.top
- **ç›¸å†Œç®¡ç†**: http://47.104.216.235:3000
- **GitHub ä»“åº“**: https://github.com/Kylaan/blog_valaxy

---

## ğŸ“Œ é‡è¦æé†’

1. âš ï¸ **ä¸è¦ä½¿ç”¨å¢é‡æ„å»º**ï¼šValaxy æ˜¯ Vue SSR åº”ç”¨ï¼Œå¿…é¡»å®Œæ•´æ„å»ºã€‚
2. âš ï¸ **æ—¥æœŸæ ¼å¼ç»Ÿä¸€**ï¼šé¿å…ä½¿ç”¨ `toISOString()`ï¼Œä½¿ç”¨æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸²ã€‚
3. âš ï¸ **æƒé™ç®¡ç†**ï¼šæœåŠ¡å™¨ `dist/` ç›®å½•å¿…é¡»æ˜¯ `www:www` ç”¨æˆ·ã€‚
4. âš ï¸ **ç¯å¢ƒå˜é‡**ï¼š`album-admin/.env` ä¸è¦æäº¤åˆ° Gitï¼ˆå·²åœ¨ `.gitignore`ï¼‰ã€‚
5. âš ï¸ **PM2 ç®¡ç†**ï¼šæœåŠ¡å™¨ä¸Š album-admin ä½¿ç”¨ PM2 å®ˆæŠ¤è¿›ç¨‹ã€‚

---

## ğŸ’¡ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¼€å‘
pnpm dev                    # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd album-admin && node server.js  # å¯åŠ¨ç›¸å†Œç®¡ç†

# æ„å»º
pnpm build:ssg             # é™æ€ç«™ç‚¹ç”Ÿæˆ

# éƒ¨ç½²
git push origin main       # è§¦å‘äº‘æ•ˆè‡ªåŠ¨éƒ¨ç½²

# æœåŠ¡å™¨
ssh root@47.104.216.235    # è¿æ¥æœåŠ¡å™¨
pm2 restart album-admin    # é‡å¯ç›¸å†ŒæœåŠ¡
nginx -s reload            # é‡è½½ Nginx

# è°ƒè¯•
pm2 logs album-admin       # æŸ¥çœ‹æ—¥å¿—
pnpm build:ssg             # æœ¬åœ°æµ‹è¯•æ„å»º
```

---

**æœ€åæ›´æ–°**: 2025-10-30
**é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­
**å·²çŸ¥é—®é¢˜**: æ— 
