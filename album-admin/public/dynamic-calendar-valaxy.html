<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Áõ∏ÂÜåÊó•ÂéÜ - Kylaan's Blog</title>
  
  <!-- ÂºïÂÖ• Valaxy Ê†∑Âºè -->
  <link rel="stylesheet" href="/styles/main.css">
  
  <style>
    /* Âü∫‰∫é albums.vue ÁöÑÊ†∑Âºè */
    :root {
      --cal-cell: clamp(3rem, 4.5vw, 4.5rem);
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--va-c-bg-soft, #f5f5f5);
    }
    
    .page-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    
    .page-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--va-c-divider, #e0e0e0);
    }
    
    .page-header h1 {
      font-size: 2rem;
      color: var(--va-c-text, #333);
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .calendar-actions {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      max-width: calc(7 * var(--cal-cell) + 6 * 0.6rem);
      margin: 0 auto 1.5rem;
    }
    
    .calendar-actions button {
      padding: 0.5rem 1rem;
      border: 1px solid var(--va-c-divider, #ddd);
      background: var(--va-c-bg, white);
      color: var(--va-c-text, #333);
      border-radius: 0.375rem;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
    }
    
    .calendar-actions button:hover {
      background: var(--va-c-bg-soft, #f5f5f5);
      border-color: var(--va-c-primary, #667eea);
    }
    
    .month-label {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--va-c-text, #333);
      white-space: nowrap;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, var(--cal-cell));
      gap: 0.6rem;
      justify-content: center;
      margin: 0 auto;
    }
    
    .weekday {
      text-align: center;
      font-weight: 600;
      padding: 0.25rem 0;
      color: var(--va-c-text-2, #666);
      font-size: 0.875rem;
    }
    
    .day-cell {
      width: var(--cal-cell);
      height: calc(var(--cal-cell) * 0.95);
      border-radius: 0.5rem;
      padding: 0.25rem;
      background: var(--va-c-bg, white);
      box-sizing: border-box;
      min-width: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .day-cell.other-month {
      opacity: 0.45;
    }
    
    .day-cell.today {
      box-shadow: 0 0 0 2px rgba(127, 199, 235, 0.644);
    }
    
    .day-cell.has-album {
      border: 1.5px solid rgba(var(--va-c-primary-rgb, 102, 126, 234), 0.35);
      background: rgba(var(--va-c-primary-rgb, 102, 126, 234), 0.18);
      cursor: pointer;
    }
    
    .day-cell.has-album:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(var(--va-c-primary-rgb, 102, 126, 234), 0.25);
    }
    
    .day-num {
      font-weight: 700;
      font-size: 1rem;
      color: var(--va-c-text, #333);
      position: relative;
      z-index: 1;
    }
    
    .album-badge {
      position: absolute;
      right: 0.45rem;
      bottom: 0.35rem;
      width: 0.6rem;
      height: 0.6rem;
      border-radius: 50%;
      background: var(--va-c-primary, #667eea);
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.12);
      z-index: 2;
      pointer-events: none;
    }
    
    .album-title {
      position: absolute;
      bottom: 0.25rem;
      left: 0.25rem;
      right: 0.25rem;
      font-size: 0.625rem;
      color: var(--va-c-text-2, #666);
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      opacity: 0.8;
    }
    
    .loading, .error {
      text-align: center;
      padding: 3rem;
      color: var(--va-c-text-2, #666);
      font-size: 1rem;
    }
    
    .error {
      color: #e85959;
    }
    
    /* ÂìçÂ∫îÂºè */
    @media (max-width: 600px) {
      :root {
        --cal-cell: clamp(2.1rem, 12vw, 2.7rem);
      }
      
      .calendar-grid {
        gap: 0.28rem;
      }
      
      .album-badge {
        right: 0.18rem;
        bottom: 0.18rem;
        width: 0.38rem;
        height: 0.38rem;
      }
      
      .page-header h1 {
        font-size: 1.5rem;
      }
      
      .page-container {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="page-header">
      <h1>
        <span>üì∏</span>
        <span>Áõ∏ÂÜåÊó•ÂéÜ</span>
      </h1>
    </div>
    
    <div class="calendar-actions">
      <button onclick="prevMonth()">‚Üê ‰∏ä‰∏™Êúà</button>
      <div class="month-label" id="month-label"></div>
      <button onclick="nextMonth()">‰∏ã‰∏™Êúà ‚Üí</button>
    </div>
    
    <div id="loading" class="loading">Âä†ËΩΩ‰∏≠...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="calendar-container" style="display: none;">
      <div class="calendar-grid" id="calendar-grid"></div>
    </div>
  </div>

  <script>
    let currentDate = new Date();
    let albums = [];
    
    const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
    
    // Ê†ºÂºèÂåñÊó•Êúü‰∏∫ YYYY-MM-DDÔºàÈÅøÂÖçÊó∂Âå∫ÈóÆÈ¢òÔºâ
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    // Âä†ËΩΩÁõ∏ÂÜåÂàóË°®
    async function loadAlbums() {
      try {
        const response = await fetch('/api/public/albums/list');
        const data = await response.json();
        
        if (!data.success) {
          throw new Error(data.error);
        }
        
        albums = data.albums;
        renderCalendar();
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('calendar-container').style.display = 'block';
      } catch (error) {
        console.error('Âä†ËΩΩÂ§±Ë¥•:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = 'Âä†ËΩΩÂ§±Ë¥•: ' + error.message;
      }
    }
    
    // Ê∏≤ÊüìÊó•ÂéÜ
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      // Êõ¥Êñ∞Êúà‰ªΩÊ†áÁ≠æ
      document.getElementById('month-label').textContent = 
        `${year}Âπ¥${month + 1}Êúà`;
      
      // ÂàõÂª∫Áõ∏ÂÜåÊó•ÊúüÁ¥¢Âºï
      const albumMap = {};
      albums.forEach(album => {
        albumMap[album.date] = album;
      });
      
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';
      
      // Ê∏≤ÊüìÊòüÊúüÊ†áÈ¢ò
      weekdays.forEach(day => {
        const weekdayEl = document.createElement('div');
        weekdayEl.className = 'weekday';
        weekdayEl.textContent = day;
        grid.appendChild(weekdayEl);
      });
      
      // Ëé∑ÂèñÂΩìÊúàÁ¨¨‰∏ÄÂ§©ÂíåÊúÄÂêé‰∏ÄÂ§©
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      
      // Ëé∑ÂèñÂΩìÊúàÁ¨¨‰∏ÄÂ§©ÊòØÊòüÊúüÂá†
      const firstDayOfWeek = firstDay.getDay();
      
      // Ëé∑Âèñ‰∏ä‰∏™ÊúàÁöÑÂ§©Êï∞
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      
      // ‰ªäÂ§©ÁöÑÊó•ÊúüÂ≠óÁ¨¶‰∏≤
      const today = new Date();
      const todayStr = formatDate(today);
      
      // Ê∏≤Êüì‰∏ä‰∏™ÊúàÁöÑÊó•ÊúüÔºàÂ°´ÂÖÖÔºâ
      for (let i = firstDayOfWeek - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        const d = new Date(year, month - 1, day);
        const dateStr = formatDate(d);
        renderDayCell(day, dateStr, true, false);
      }
      
      // Ê∏≤ÊüìÂΩìÊúàÊó•Êúü
      for (let day = 1; day <= daysInMonth; day++) {
        const d = new Date(year, month, day);
        const dateStr = formatDate(d);
        const isToday = dateStr === todayStr;
        renderDayCell(day, dateStr, false, isToday);
      }
      
      // Ê∏≤Êüì‰∏ã‰∏™ÊúàÁöÑÊó•ÊúüÔºàÂ°´ÂÖÖÔºâ
      const totalCells = firstDayOfWeek + daysInMonth;
      const remainingCells = 7 - (totalCells % 7);
      if (remainingCells < 7) {
        for (let day = 1; day <= remainingCells; day++) {
          const d = new Date(year, month + 1, day);
          const dateStr = formatDate(d);
          renderDayCell(day, dateStr, true, false);
        }
      }
    }
    
    // Ê∏≤ÊüìÂçï‰∏™Êó•ÊúüÂçïÂÖÉÊ†º
    function renderDayCell(day, dateStr, otherMonth, isToday) {
      const grid = document.getElementById('calendar-grid');
      const album = albums.find(a => a.date === dateStr);
      
      const cell = document.createElement('div');
      cell.className = 'day-cell';
      if (otherMonth) cell.classList.add('other-month');
      if (isToday) cell.classList.add('today');
      if (album) cell.classList.add('has-album');
      
      if (album) {
        cell.innerHTML = `
          <span class="album-badge"></span>
          <div class="day-num">${day}</div>
        `;
        cell.onclick = () => {
          window.location.href = album.url;
        };
      } else {
        cell.innerHTML = `<div class="day-num">${day}</div>`;
      }
      
      grid.appendChild(cell);
    }
    
    // ‰∏ä‰∏™Êúà
    function prevMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }
    
    // ‰∏ã‰∏™Êúà
    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }
    
    // È°µÈù¢Âä†ËΩΩÊó∂ÊâßË°å
    loadAlbums();
  </script>
</body>
</html>
