import"./chunks/@vueuse/motion.DhjSK7p0.js";import{u as m}from"./chunks/vue-router.C9-pOeEs.js";import{a9 as k,U as i,bb as l,aX as y,Z as b,b3 as g,_ as n,aO as c,bt as u,c6 as C}from"./framework.Dgturmf_.js";const w={class:"custom-like-container"},N=["disabled"],S={class:"text"},O={class:"count"},p="https://comment.kylaan.top/api/",T=k({__name:"YunSponsor",setup(E){const d=m(),o=i(()=>d.path),a=l(0),e=l(!1),s=l(!0);async function v(){s.value=!0;try{const t=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"GET_COUNTER",url:o.value})});if(!t.ok)throw new Error("Network response was not ok");const r=await t.json();a.value=r.result[0]?.time||0}catch(t){console.error("获取点赞数失败:",t),a.value=0}finally{s.value=!1}}async function _(){try{if(!(await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"INC_COUNTER",url:o.value})})).ok)throw new Error("Like request failed");console.log("点赞成功!")}catch(t){console.error("点赞请求失败:",t),a.value--,e.value=!1,localStorage.removeItem(`liked-${o.value}`),alert("点赞失败，请稍后重试")}}const f=i(()=>s.value?"...":a.value);y(()=>{localStorage.getItem(`liked-${o.value}`)&&(e.value=!0),v()});async function h(){e.value||(e.value=!0,a.value++,localStorage.setItem(`liked-${o.value}`,"true"),await _())}return(t,r)=>(g(),b("div",w,[n("button",{class:c(["like-button",{liked:e.value}]),onClick:h,disabled:e.value||s.value},[n("div",{class:c(["icon",e.value?"i-ri-heart-fill":"i-ri-heart-line"])},null,2),n("span",S,u(e.value?"感谢支持!":"点个赞"),1),n("span",O,u(f.value),1)],10,N)]))}}),x=C(T,[["__scopeId","data-v-14c4459b"]]);export{x as _};
